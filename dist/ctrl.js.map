{"version":3,"sources":["../src/ctrl.js"],"names":["panelDefaults","code","allowScrollbars","renderNow","e","jElem","error","isValid","ctrl","data","elem","jContent","jQuery","html","type","css","styles","JS","fn","Function","panel","result","toArray","dom","reduce","carry","value","concat","typeOf","forEach","append","console","text","message","EvalPanelCtrl","$scope","$injector","$rootScope","_","defaults","events","on","onInitEditMode","bind","onDataReceived","onDataError","addEditorTab","dataList","length","isReal","columns","rows","emit","scope","attrs","call","debounce","MetricsPanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport JS from './external/YourJS.min';\n\nconst panelDefaults = {\n  code: '',\n  allowScrollbars: true\n};\n\nfunction renderNow(e, jElem) {\n  let error,\n      isValid = false,\n      ctrl = this,\n      data = ctrl.data,\n      elem = jElem[0],\n      jContent = jQuery('.panel-content', elem).html('');\n  if (data) {\n    if (data.type === 'table') {\n      try {\n        function css(styles) { return JS.css(styles, jContent[0]); }\n        var fn = new Function('ctrl, dom, css', ctrl.panel.code + '\\nreturn main(ctrl)');\n        var result = JS.toArray(fn(ctrl, JS.dom, css))\n          .reduce(function(carry, value) {\n            return carry.concat(\n              JS.typeOf(value) === 'String'\n                ? jQuery('<div>').html(value).toArray()\n                : [value]\n            );\n          }, [])\n          .forEach(function(elem) { jContent.append(elem); });\n        isValid = true;\n      }\n      catch(e) {\n        console.error(error = e);\n      }\n    }\n  }\n  if (!isValid) {\n    jContent\n      .text('No data' + (error ? ':  \\r\\n' + error.message : '.'))\n      .css('text-align', 'center');\n  }\n  jContent\n    .css('overflow', ctrl.panel.allowScrollbars ? 'auto' : 'hidden');\n}\n\nexport class EvalPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.data = null;\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/westc-eval-panel/partials/editor.html', 2);\n  }\n\n  onDataError() {\n    this.renderNow();\n  }\n\n  onDataReceived(dataList) {\n    if (dataList && dataList.length) {\n      let data = dataList[0];\n      this.data = {\n        isReal: true,\n        type: data.type,\n        columns: data.columns,\n        rows: data.rows\n      };\n    }\n    else {\n      this.data = {\n        isReal: false,\n        type: 'table',\n        columns: [{text: \"Off\"}, {text: \"Down\"}, {text: \"Run\"}, {text: \"Idle\"}],\n        rows: [\n          [ 15, 50, 0, 40 ],\n          [ 15, 5, 40, 15 ],\n          [ 15, 30, 40, 15 ],\n          [ 15, 30, 80, 15 ]\n        ]\n      };\n    }\n\n    this.renderNow();\n  }\n\n  renderNow() {\n    this.events.emit('renderNow');\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.events.on('renderNow', e => renderNow.call(this, e, elem));\n    this.events.on('render', _.debounce(e => renderNow.call(this, e, elem), 250));\n  }\n}\n\nEvalPanelCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}