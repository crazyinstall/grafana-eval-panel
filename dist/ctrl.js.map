{"version":3,"sources":["../src/ctrl.js"],"names":["panelDefaults","code","allowScrollbars","renderNow","e","jElem","error","isValid","ctrl","data","jContent","find","html","elemContent","className","replace","trim","type","css","styles","JS","fn","Function","panel","result","toArray","dom","forEach","elems","console","log","typeOf","jQuery","nodeType","elem","appendChild","text","message","EvalPanelCtrl","$scope","$injector","$rootScope","_","defaults","events","on","onInitEditMode","bind","onDataReceived","onDataError","addEditorTab","dataList","length","isReal","columns","rows","emit","scope","attrs","call","debounce","MetricsPanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport JS from './external/YourJS.min';\n\nconst panelDefaults = {\n  code: '',\n  allowScrollbars: true\n};\n\nfunction renderNow(e, jElem) {\n  let error,\n      isValid = false,\n      ctrl = this,\n      data = ctrl.data,\n      jContent = jElem.find('.panel-content').html(''),\n      elemContent = jContent[0];\n\n  elemContent.className = elemContent.className.replace(/\\b_\\d+\\b/g, ' ').replace(/\\s+/g, ' ').trim();\n  \n  if (data) {\n    if (data.type === 'table') {\n      try {\n        function css(styles) { return JS.css(styles, elemContent); }\n        var fn = new Function('ctrl, dom, css', ctrl.panel.code + '\\nreturn main(ctrl)');\n        var result = JS.toArray(fn(ctrl, JS.dom, css))\n          .forEach(function(elems) {\n            console.log({ elems });\n            (JS.typeOf(elems) === 'String'\n              ? jQuery('<div>').html(elems).toArray()\n              : (elems && elems.nodeType === 1)\n                ? [elems]\n                : []\n            ).forEach(function (elem) { console.log({ elemContent, elem }); elemContent.appendChild(elem); });\n          });\n        isValid = true;\n      }\n      catch(e) {\n        console.error(error = e);\n      }\n    }\n  }\n  if (!isValid) {\n    jContent\n      .text('No data' + (error ? ':  \\r\\n' + error.message : '.'))\n      .css('text-align', 'center');\n  }\n  jContent\n    .css('overflow', ctrl.panel.allowScrollbars ? 'auto' : 'hidden');\n}\n\nexport class EvalPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.data = null;\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/westc-eval-panel/partials/editor.html', 2);\n  }\n\n  onDataError() {\n    this.renderNow();\n  }\n\n  onDataReceived(dataList) {\n    if (dataList && dataList.length) {\n      let data = dataList[0];\n      this.data = {\n        isReal: true,\n        type: data.type,\n        columns: data.columns,\n        rows: data.rows\n      };\n    }\n    else {\n      this.data = {\n        isReal: false,\n        type: 'table',\n        columns: [{text: \"Off\"}, {text: \"Down\"}, {text: \"Run\"}, {text: \"Idle\"}],\n        rows: [\n          [ 15, 50, 0, 40 ],\n          [ 15, 5, 40, 15 ],\n          [ 15, 30, 40, 15 ],\n          [ 15, 30, 80, 15 ]\n        ]\n      };\n    }\n\n    this.renderNow();\n  }\n\n  renderNow() {\n    this.events.emit('renderNow');\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.events.on('renderNow', e => renderNow.call(this, e, elem));\n    this.events.on('render', _.debounce(e => renderNow.call(this, e, elem), 250));\n  }\n}\n\nEvalPanelCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}